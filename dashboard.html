<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>e-Civilian Portal — Dashboard</title>
</head>
<body>
<h2>e-Civilian Portal — Dashboard</h2>
<div id="info">Checking login...</div>
<button id="logoutBtn">Logout</button>


<script type="module">
import { auth, db } from './firebase-init.js';
import { signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
import { collection, query, where, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";


const info = document.getElementById('info');
const logoutBtn = document.getElementById('logoutBtn');


onAuthStateChanged(auth, async (user) => {
if (!user) {
// not logged in
window.location.href = 'login.html';
return;
}


// find citizens record with this uid
const q = query(collection(db, 'citizens'), where('uid', '==', user.uid));
const snap = await getDocs(q);
if (snap.empty) {
info.innerHTML = 'No citizen record found for this account.';
return;
}


const docData = snap.docs[0].data();
const name = docData.name || user.displayName || '(Name not set)';
const civil = docData.civilID || '(unknown)';
const email = docData.email || user.email;


info.innerHTML = `<p>Welcome, <strong>${name}</strong></p>
<p>Civil ID: <strong>${civil}</strong></p>
<p>Email: <strong>${email}</strong></p>`;
});


logoutBtn.addEventListener('click', async () => {
await signOut(auth);
window.location.href = 'login.html';
});
</script>
</body>
</html>